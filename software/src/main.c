#include "ch32fun.h"
#include <stdio.h>

// use defines to make more meaningful names for our GPIO pins
#define PORT_RGB GPIOD
#define PIN_RGB PD0
#define PIN_RGB_NUM (PIN_RGB & 0xf)
// Include the implementation of the rgb led driver
#define RGB_LED_IMPLEMENTATION

#include "tz_5050s2_driver.h"

#define NUM_LEDS 24

uint8_t rainbow[] = {
	0x80, 0x00, 0x00,
	0x80, 0x20, 0x00,
	0x80, 0x40, 0x00,
	0x80, 0x60, 0x00,
	0x80, 0x80, 0x00,
	0x60, 0x80, 0x00,
	0x40, 0x80, 0x00,
	0x20, 0x80, 0x00,
	0x00, 0x80, 0x00,
	0x00, 0x80, 0x20,
	0x00, 0x80, 0x40,
	0x00, 0x80, 0x60,
	0x00, 0x80, 0x80,
	0x00, 0x60, 0x80,
	0x00, 0x40, 0x80,
	0x00, 0x20, 0x80,
	0x00, 0x00, 0x80,
	0x20, 0x00, 0x80,
	0x40, 0x00, 0x80,
	0x60, 0x00, 0x80,
	0x80, 0x00, 0x80,
	0x80, 0x00, 0x60,
	0x80, 0x00, 0x40,
	0x80, 0x00, 0x20,
};

int main()
{
	SystemInit();

	funGpioInitAll(); // Enable GPIOs
	
	RGBInit(PIN_RGB);

	int frame = 0;
	// uint32_t iteration = 1;
	while(1)
	{
		// printf("Iteration: %lu\nFrame: %i\n", iteration, frame);
		RGBSend(PORT_RGB, PIN_RGB_NUM, rainbow, sizeof(rainbow), frame, 3*NUM_LEDS);
		frame += 3;
		frame %= (int)sizeof(rainbow);
		Delay_Ms(50);
	}
}
