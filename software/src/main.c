#include "ch32fun.h"
#include <stdio.h>

// use defines to make more meaningful names for our GPIO pins
#define PORT_RGB GPIOA
#define PIN_RGB PA1
#define PIN_RGB_NUM (PIN_RGB & 0xf)
#define WS2812BSIMPLE_IMPLEMENTATION
#define NUM_LEDS 24

#include "tz_5050s2_driver.h"

uint8_t rainbow[] = {
	0x80, 0x00, 0x00,
	0x80, 0x20, 0x00,
	0x80, 0x40, 0x00,
	0x80, 0x60, 0x00,
	0x80, 0x80, 0x00,
	0x60, 0x80, 0x00,
	0x40, 0x80, 0x00,
	0x20, 0x80, 0x00,
	0x00, 0x80, 0x00,
	0x00, 0x80, 0x20,
	0x00, 0x80, 0x40,
	0x00, 0x80, 0x60,
	0x00, 0x80, 0x80,
	0x00, 0x60, 0x80,
	0x00, 0x40, 0x80,
	0x00, 0x20, 0x80,
	0x00, 0x00, 0x80,
	0x20, 0x00, 0x80,
	0x40, 0x00, 0x80,
	0x60, 0x00, 0x80,
	0x80, 0x00, 0x80,
	0x80, 0x00, 0x60,
	0x80, 0x00, 0x40,
	0x80, 0x00, 0x20,
};

int main()
{
	SystemInit();

	funGpioInitAll(); // Enable GPIOs

	funPinMode( PIN_RGB,   GPIO_CFGLR_OUT_2Mhz_PP ); // Set PIN_RGB to output


	int frame = 0;
	while(1)
	{
		WS2812BSimpleSend(PORT_RGB, PIN_RGB_NUM, rainbow, sizeof(rainbow), frame, 3*NUM_LEDS);
		frame += 3;
		frame %= (int)sizeof(rainbow);
		Delay_Ms( 50 );
	}
}
